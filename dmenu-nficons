#!/bin/sh

# dmenu based nerd fonts icon chooser, so i don't have to open the cheatsheet
# every time

# change this to -ix if you're using the printindex patch
printindex_opt="-I"

die() {
	>&2 echo "$@"
	exit 1
}

usage() {
	die "usage: ${0##*/} [FILE] [DMENU_OPTS]\n"\
"options:\n"\
"\tFILE          path to nficons.csv file generated by get_nficons.py,\n"\
"\t              defaults to \$XDG_CACHE_HOME/nficons.csv or\n"\
"\t              \$HOME/.cache/nficons.csv\n"
"\tDMENU_OPTS    options to passthrough to dmenu"
}

if [ -f "$1" ]; then
	iconsfile="$1"
	shift
else
	iconsfile="${XDG_CACHE_HOME:-$HOME/.cache}/nficons.csv"
	[ -f "$iconsfile" ] || usage
fi

index=$(tail -n+2 "$iconsfile" | while IFS=, read -r id name icon; do
	echo "$icon : ${name#nf-}"
done | dmenu "$printindex_opt" "$@")

if [ -n "$index" ]; then
	icon=$(tail -n+"$((index+2))" "$iconsfile" | head -n1 | cut -d, -f3)
	echo "$icon" | tr -d '\n' | xclip -selection clipboard
	xdotool type "$icon"
fi
